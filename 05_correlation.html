<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiểu Về Hệ Số Tương Quan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.3em;
            max-width: 600px;
            margin: 0 auto;
        }

        .step-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            display: none;
            animation: slideIn 0.6s ease-out forwards;
        }

        .step-container.active {
            display: block;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #3498db;
        }

        .step-number {
            background: #3498db;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-right: 20px;
        }

        .step-title {
            font-size: 2em;
            color: #2c3e50;
            font-weight: 600;
        }

        .real-example {
            background: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .real-example h3 {
            color: #16a085;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .demo-area {
            background: #f8f9fa;
            border: 2px dashed #3498db;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
        }

        .correlation-playground {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin: 30px 0;
        }

        .scatter-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .scatter-plot {
            width: 100%;
            height: 400px;
            border: 2px solid #3498db;
            border-radius: 10px;
            background: #fafafa;
            position: relative;
            cursor: crosshair;
            margin-bottom: 15px;
        }

        .correlation-info {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .correlation-value {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .interpretation {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .strength-meter {
            background: #ecf0f1;
            height: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .strength-fill {
            height: 100%;
            border-radius: 10px;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .concept-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .concept-box h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .formula-highlight {
            background: #f4f4f4;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .example-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .example-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .example-card.positive {
            border-color: #e74c3c;
        }

        .example-card.negative {
            border-color: #3498db;
        }

        .example-card.zero {
            border-color: #95a5a6;
        }

        .quiz-option {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid #ecf0f1;
        }

        .quiz-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .quiz-progress {
            background: #ecf0f1;
            height: 6px;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .quiz-progress-fill {
            background: linear-gradient(90deg, #3498db, #2980b9);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .example-r {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }

        .mini-scatter {
            width: 80px;
            height: 60px;
            background: #f8f9fa;
            border-radius: 5px;
            margin: 10px auto;
            position: relative;
        }

        .mini-point {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #e74c3c;
            border-radius: 50%;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-primary {
            background: #3498db;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-next {
            background: #e67e22;
            font-size: 18px;
            padding: 15px 30px;
        }

        .btn-next:hover {
            background: #d35400;
            transform: translateY(-2px);
        }

        .progress-container {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #3498db, #2980b9);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .step-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #bdc3c7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: #3498db;
            transform: scale(1.3);
        }

        .nav-dot.completed {
            background: #27ae60;
        }

        .point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            transform: translate(-4px, -4px);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .point:hover {
            background: #c0392b;
            transform: translate(-4px, -4px) scale(1.4);
        }

        .highlight-box {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .warning-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .correlation-playground {
                grid-template-columns: 1fr;
            }
            
            .examples-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔗 Hiểu Về Hệ Số Tương Quan</h1>
            <p>Từ câu hỏi thực tế đến khái niệm thống kê - Học một cách trực quan và kiểm tra với 10 câu hỏi thực tế</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 20%"></div>
        </div>

        <div class="step-navigation">
            <div class="nav-dot active" onclick="goToStep(0)"></div>
            <div class="nav-dot" onclick="goToStep(1)"></div>
            <div class="nav-dot" onclick="goToStep(2)"></div>
            <div class="nav-dot" onclick="goToStep(3)"></div>
            <div class="nav-dot" onclick="goToStep(4)"></div>
            <div class="nav-dot" onclick="startQuiz()" style="background: #e74c3c;" title="Quiz"></div>
        </div>

        <!-- Step 1: Bắt đầu từ câu hỏi thực tế -->
        <div class="step-container active" id="step0">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">Bắt Đầu Từ Câu Hỏi Thực Tế</div>
            </div>

            <div class="real-example">
                <h3>🤔 Câu hỏi từ cuộc sống:</h3>
                <p style="font-size: 1.2em;"><strong>"Học nhiều giờ hơn có thực sự giúp điểm thi cao hơn không?"</strong></p>
                <p style="margin-top: 15px;">Hoặc: <em>"Chiều cao và cân nặng có liên quan gì với nhau?"</em></p>
            </div>

            <div class="demo-area">
                <h3>🎯 Đây chính là lúc chúng ta cần HỆ SỐ TƯƠNG QUAN!</h3>
                <p style="font-size: 1.1em; margin-top: 15px;">
                    Hệ số tương quan giúp chúng ta trả lời: <strong>"Hai thứ có đi cùng nhau không?"</strong>
                </p>
            </div>

            <div class="examples-grid">
                <div class="example-card positive">
                    <h4>📈 Ví dụ Tương quan Thuận</h4>
                    <div class="mini-scatter" id="positiveExample"></div>
                    <p><strong>Thời gian học ↗️ Điểm số ↗️</strong></p>
                    <p>Học nhiều → Điểm cao</p>
                </div>

                <div class="example-card negative">
                    <h4>📉 Ví dụ Tương quan Nghịch</h4>
                    <div class="mini-scatter" id="negativeExample"></div>
                    <p><strong>Thời gian xem TV ↗️ Điểm số ↘️</strong></p>
                    <p>Xem TV nhiều → Điểm thấp</p>
                </div>

                <div class="example-card zero">
                    <h4>📊 Ví dụ Không Tương quan</h4>
                    <div class="mini-scatter" id="zeroExample"></div>
                    <p><strong>Màu áo ↔️ Điểm số</strong></p>
                    <p>Màu áo không ảnh hưởng điểm</p>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-next" onclick="nextStep()">Tiếp tục tìm hiểu ➡️</button>
            </div>
        </div>

        <!-- Step 2: Học cách "nhìn" tương quan -->
        <div class="step-container" id="step1">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">Học Cách "Nhìn" Tương Quan</div>
            </div>

            <div class="concept-box">
                <h3>💡 Khái niệm đơn giản:</h3>
                <p style="font-size: 1.2em;">
                    <strong>Hệ số tương quan (r)</strong> là một con số từ <strong>-1 đến +1</strong> 
                    cho biết hai biến có "đi cùng nhau" không.
                </p>
            </div>

            <div class="correlation-playground">
                <div class="scatter-container">
                    <h3>🎨 Thử vẽ điểm để thấy tương quan!</h3>
                    <p><em>Click vào biểu đồ để thêm điểm dữ liệu</em></p>
                    <div class="scatter-plot" id="scatterPlot"></div>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="clearPoints()">🗑️ Xóa hết</button>
                        <button class="btn btn-success" onclick="showExample('straight-up')">📈 Thẳng lên</button>
                        <button class="btn btn-success" onclick="showExample('straight-down')">📉 Thẳng xuống</button>
                        <button class="btn btn-success" onclick="showExample('scattered')">🎲 Rải rác</button>
                    </div>
                </div>

                <div class="correlation-info">
                    <h3>📊 Kết quả:</h3>
                    <div class="correlation-value" id="correlationValue">r = ?</div>
                    <div class="strength-meter">
                        <div class="strength-fill" id="strengthFill" style="width: 0%; background: #95a5a6;">Chưa có dữ liệu</div>
                    </div>
                    <div class="interpretation" id="interpretationText">
                        Hãy thêm ít nhất 3 điểm để xem kết quả!
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <h3>🎯 Điều quan trọng cần nhớ:</h3>
                <ul style="font-size: 1.1em;">
                    <li><strong>r gần +1:</strong> Đi cùng hướng mạnh (này tăng, kia cũng tăng)</li>
                    <li><strong>r gần -1:</strong> Đi ngược hướng mạnh (này tăng, kia giảm)</li>
                    <li><strong>r gần 0:</strong> Không có quy luật rõ ràng</li>
                </ul>
            </div>

            <div class="controls">
                <button class="btn btn-next" onclick="nextStep()">Hiểu rồi, tiếp tục ➡️</button>
            </div>
        </div>

        <!-- Step 3: Học cách diễn giải -->
        <div class="step-container" id="step2">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">Học Cách Diễn Giải Kết Quả</div>
            </div>

            <div class="real-example">
                <h3>📝 Ví dụ thực tế: Nghiên cứu thời gian học và điểm thi</h3>
                <p>Giả sử chúng ta thu thập dữ liệu từ 50 sinh viên về thời gian học và điểm thi Toán.</p>
            </div>

            <div class="examples-grid">
                <div class="example-card" onclick="explainResult(0.85, 'mạnh', 'thuận')">
                    <div class="example-r" style="color: #27ae60;">r = +0.85</div>
                    <h4>Tương quan thuận mạnh</h4>
                    <p>Click để xem diễn giải</p>
                </div>

                <div class="example-card" onclick="explainResult(0.45, 'trung bình', 'thuận')">
                    <div class="example-r" style="color: #f39c12;">r = +0.45</div>
                    <h4>Tương quan thuận trung bình</h4>
                    <p>Click để xem diễn giải</p>
                </div>

                <div class="example-card" onclick="explainResult(-0.72, 'mạnh', 'nghịch')">
                    <div class="example-r" style="color: #3498db;">r = -0.72</div>
                    <h4>Tương quan nghịch mạnh</h4>
                    <p>Click để xem diễn giải</p>
                </div>

                <div class="example-card" onclick="explainResult(0.12, 'yếu', 'thuận')">
                    <div class="example-r" style="color: #95a5a6;">r = +0.12</div>
                    <h4>Tương quan rất yếu</h4>
                    <p>Click để xem diễn giải</p>
                </div>
            </div>

            <div class="interpretation" id="resultExplanation" style="display: none;">
                <!-- Explanation will be shown here -->
            </div>

            <div class="concept-box">
                <h3>📏 Thang đo độ mạnh tương quan:</h3>
                <ul style="font-size: 1.1em;">
                    <li><strong>|r| > 0.8:</strong> Rất mạnh - Có thể dự đoán khá chính xác</li>
                    <li><strong>0.6 < |r| ≤ 0.8:</strong> Mạnh - Có mối liên hệ rõ ràng</li>
                    <li><strong>0.4 < |r| ≤ 0.6:</strong> Trung bình - Có liên hệ nhưng không chặt chẽ</li>
                    <li><strong>0.2 < |r| ≤ 0.4:</strong> Yếu - Liên hệ nhẹ</li>
                    <li><strong>|r| ≤ 0.2:</strong> Rất yếu - Hầu như không có liên hệ</li>
                </ul>
            </div>

            <div class="controls">
                <button class="btn btn-next" onclick="nextStep()">Đã hiểu cách diễn giải ➡️</button>
            </div>
        </div>

        <!-- Step 4: Khi nào sử dụng -->
        <div class="step-container" id="step3">
            <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-title">Khi Nào Sử dụng Hệ Số Tương Quan?</div>
            </div>

            <div class="examples-grid">
                <div class="example-card" style="border-color: #27ae60;">
                    <h4>✅ NÊN sử dụng khi:</h4>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>Muốn biết 2 biến có liên quan không</li>
                        <li>Dữ liệu là số (chiều cao, điểm số, tuổi...)</li>
                        <li>Muốn đo mức độ liên quan</li>
                        <li>Kiểm tra giả thuyết nghiên cứu</li>
                    </ul>
                </div>

                <div class="example-card" style="border-color: #e74c3c;">
                    <h4>❌ KHÔNG nên dùng khi:</h4>
                    <ul style="text-align: left; margin-top: 15px;">
                        <li>Dữ liệu phân loại (nam/nữ, màu sắc...)</li>
                        <li>Mối quan hệ không tuyến tính</li>
                        <li>Muốn chứng minh nhân quả</li>
                        <li>Mẫu quá nhỏ (< 10 quan sát)</li>
                    </ul>
                </div>
            </div>

            <div class="warning-box">
                <h3>⚠️ Lưu ý quan trọng:</h3>
                <p style="font-size: 1.2em; font-weight: bold; color: #d35400;">
                    Tương quan ≠ Nhân quả!
                </p>
                <p style="margin-top: 10px;">
                    Dù r = 0.9, cũng không có nghĩa là biến này GÂY RA biến kia. 
                    Ví dụ: Bán kem và tai nạn đuối nước có tương quan cao, nhưng kem không gây đuối nước - 
                    cả hai đều tăng vào mùa hè!
                </p>
            </div>

            <div class="real-example">
                <h3>🔬 Các bước thực hiện nghiên cứu tương quan:</h3>
                <ol style="font-size: 1.1em;">
                    <li><strong>Đặt câu hỏi:</strong> "X và Y có liên quan không?"</li>
                    <li><strong>Thu thập dữ liệu:</strong> Đo cả X và Y từ cùng đối tượng</li>
                    <li><strong>Tính toán:</strong> Sử dụng JAMOVI hoặc phần mềm thống kê</li>
                    <li><strong>Diễn giải:</strong> Dựa vào giá trị r và p-value</li>
                    <li><strong>Kết luận:</strong> Trả lời câu hỏi ban đầu</li>
                </ol>
            </div>

            <div class="controls">
                <button class="btn btn-next" onclick="nextStep()">Sẵn sàng ứng dụng ➡️</button>
            </div>
        </div>

        <!-- Step 5: Ứng dụng và tổng kết -->
        <div class="step-container" id="step4">
            <div class="step-header">
                <div class="step-number">5</div>
                <div class="step-title">Ứng Dụng Thực Tế & Tổng Kết</div>
            </div>

            <div class="highlight-box">
                <h3>🎯 Tóm tắt những điều quan trọng:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div>
                        <h4>💡 Hệ số tương quan là gì?</h4>
                        <p>Một con số từ -1 đến +1 đo mức độ liên quan giữa 2 biến số</p>
                    </div>
                    <div>
                        <h4>📊 Cách đọc kết quả:</h4>
                        <p>Dấu (+/-) → hướng, độ lớn |r| → mức độ mạnh yếu</p>
                    </div>
                    <div>
                        <h4>🔬 Khi nào sử dụng?</h4>
                        <p>Khi muốn biết 2 biến số có "đi cùng nhau" không</p>
                    </div>
                    <div>
                        <h4>⚠️ Điều cần nhớ:</h4>
                        <p>Tương quan ≠ Nhân quả. Chỉ đo mối quan hệ tuyến tính!</p>
                    </div>
                </div>
            </div>

            <div class="formula-highlight">
                <h3>📝 Báo cáo kết quả theo chuẩn APA:</h3>
                <p style="margin: 15px 0; font-size: 1.1em;">
                    "Kết quả phân tích tương quan Pearson cho thấy có/không có mối tương quan 
                    thuận/nghịch có ý nghĩa thống kê giữa [biến X] và [biến Y], 
                    r(df) = [giá trị], p = [p-value]."
                </p>
                <p style="font-style: italic;">
                    Ví dụ: r(48) = 0.65, p < 0.001
                </p>
            </div>

            <div class="real-example">
                <h3>🚀 Bước tiếp theo - Thực hành với JAMOVI:</h3>
                <ol style="font-size: 1.1em;">
                    <li>Mở JAMOVI → Analyses → Regression → Correlation Matrix</li>
                    <li>Chọn biến số cần phân tích vào ô Variables</li>
                    <li>Chọn Pearson ở Correlation Coefficients</li>
                    <li>Thiết lập Hypothesis (1 đuôi hay 2 đuôi)</li>
                    <li>Đọc kết quả và diễn giải theo những gì đã học!</li>
                </ol>
            </div>

            <div class="controls">
                <button class="btn btn-success" onclick="startQuiz()">🧠 Làm trắc nghiệm 10 câu</button>
                <button class="btn btn-primary" onclick="goToStep(0)">🔄 Xem lại từ đầu</button>
            </div>
        </div>

        <!-- Simple Quiz Section -->
        <div class="step-container" id="quiz" style="display: none;">
            <div class="step-header">
                <div class="step-number">🧠</div>
                <div class="step-title">Kiểm Tra Hiểu Biết</div>
            </div>
            <div id="quizContent">
                <!-- Quiz will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let points = [];
        let quizStarted = false;

        const steps = ['step0', 'step1', 'step2', 'step3', 'step4'];
        const totalSteps = 6; // 5 learning steps + 1 quiz

        function nextStep() {
            if (currentStep < steps.length - 1) {
                goToStep(currentStep + 1);
            }
        }

        function goToStep(stepIndex) {
            // Hide current step
            if (currentStep < steps.length) {
                document.getElementById(steps[currentStep]).classList.remove('active');
            }
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('quiz').classList.remove('active');
            
            // Show new step
            currentStep = stepIndex;
            document.getElementById(steps[currentStep]).classList.add('active');
            
            // Update progress
            const progress = ((currentStep + 1) / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update navigation dots
            updateNavDots();
        }

        function updateNavDots() {
            const dots = document.querySelectorAll('.nav-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index === currentStep) {
                    dot.classList.add('active');
                } else if (index < currentStep) {
                    dot.classList.add('completed');
                }
            });
        }

        function initMiniScatters() {
            // Positive correlation example
            const positive = document.getElementById('positiveExample');
            for (let i = 0; i < 8; i++) {
                const point = document.createElement('div');
                point.className = 'mini-point';
                point.style.left = (10 + i * 8) + 'px';
                point.style.top = (50 - i * 5) + 'px';
                positive.appendChild(point);
            }

            // Negative correlation example
            const negative = document.getElementById('negativeExample');
            for (let i = 0; i < 8; i++) {
                const point = document.createElement('div');
                point.className = 'mini-point';
                point.style.left = (10 + i * 8) + 'px';
                point.style.top = (10 + i * 5) + 'px';
                negative.appendChild(point);
            }

            // Zero correlation example
            const zero = document.getElementById('zeroExample');
            const randomPoints = [
                {x: 15, y: 30}, {x: 25, y: 10}, {x: 35, y: 45}, {x: 45, y: 20},
                {x: 55, y: 40}, {x: 65, y: 15}, {x: 75, y: 35}, {x: 85, y: 25}
            ];
            randomPoints.forEach(pos => {
                const point = document.createElement('div');
                point.className = 'mini-point';
                point.style.left = pos.x + 'px';
                point.style.top = pos.y + 'px';
                zero.appendChild(point);
            });
        }

        function initScatterPlot() {
            const plot = document.getElementById('scatterPlot');
            plot.addEventListener('click', addPoint);
        }

        function addPoint(event) {
            const plot = document.getElementById('scatterPlot');
            const rect = plot.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const point = document.createElement('div');
            point.className = 'point';
            point.style.left = x + 'px';
            point.style.top = y + 'px';
            
            // Add click to remove
            point.onclick = function(e) {
                e.stopPropagation();
                const index = points.findIndex(p => 
                    Math.abs(p.x - x) < 5 && Math.abs(p.y - y) < 5
                );
                if (index > -1) {
                    points.splice(index, 1);
                    point.remove();
                    updateCorrelation();
                }
            };
            
            plot.appendChild(point);
            points.push({x: x, y: y});
            updateCorrelation();
        }

        function clearPoints() {
            points = [];
            const plot = document.getElementById('scatterPlot');
            const pointElements = plot.querySelectorAll('.point');
            pointElements.forEach(point => point.remove());
            updateCorrelation();
        }

        function calculateCorrelation() {
            if (points.length < 2) return 0;
            
            const n = points.length;
            const sumX = points.reduce((sum, p) => sum + p.x, 0);
            const sumY = points.reduce((sum, p) => sum + p.y, 0);
            const meanX = sumX / n;
            const meanY = sumY / n;
            
            let numerator = 0;
            let sumXSquared = 0;
            let sumYSquared = 0;
            
            for (let point of points) {
                const dx = point.x - meanX;
                const dy = point.y - meanY;
                numerator += dx * dy;
                sumXSquared += dx * dx;
                sumYSquared += dy * dy;
            }
            
            const denominator = Math.sqrt(sumXSquared * sumYSquared);
            return denominator === 0 ? 0 : numerator / denominator;
        }

        function updateCorrelation() {
            const r = calculateCorrelation();
            const valueElement = document.getElementById('correlationValue');
            const strengthElement = document.getElementById('strengthFill');
            const interpretationElement = document.getElementById('interpretationText');
            
            if (points.length < 2) {
                valueElement.textContent = 'r = ?';
                valueElement.style.background = '#ecf0f1';
                valueElement.style.color = '#7f8c8d';
                strengthElement.style.width = '0%';
                strengthElement.style.background = '#95a5a6';
                strengthElement.textContent = 'Cần ít nhất 2 điểm';
                interpretationElement.textContent = 'Hãy thêm ít nhất 2 điểm để xem kết quả!';
                return;
            }
            
            valueElement.textContent = `r = ${r.toFixed(3)}`;
            
            const absR = Math.abs(r);
            let strength, color, interpretation;
            
            if (absR >= 0.8) {
                strength = 'Rất mạnh';
                color = '#27ae60';
            } else if (absR >= 0.6) {
                strength = 'Mạnh';
                color = '#2ecc71';
            } else if (absR >= 0.4) {
                strength = 'Trung bình';
                color = '#f39c12';
            } else if (absR >= 0.2) {
                strength = 'Yếu';
                color = '#e67e22';
            } else {
                strength = 'Rất yếu';
                color = '#95a5a6';
            }
            
            const direction = r > 0 ? 'thuận' : r < 0 ? 'nghịch' : 'không có';
            
            valueElement.style.background = color;
            valueElement.style.color = 'white';
            
            strengthElement.style.width = (absR * 100) + '%';
            strengthElement.style.background = color;
            strengthElement.textContent = `${strength} (${(absR * 100).toFixed(0)}%)`;
            
            interpretation = r === 0 ? 'Không có tương quan tuyến tính' :
                           `Tương quan ${direction} ${strength.toLowerCase()}`;
            
            interpretationElement.innerHTML = `
                <strong>${interpretation}</strong><br>
                ${r > 0 ? '📈 Khi một biến tăng, biến kia cũng có xu hướng tăng' :
                  r < 0 ? '📉 Khi một biến tăng, biến kia có xu hướng giảm' :
                  '📊 Không có quy luật rõ ràng giữa hai biến'}
            `;
        }

        function showExample(type) {
            clearPoints();
            const plot = document.getElementById('scatterPlot');
            const width = plot.clientWidth;
            const height = plot.clientHeight;
            
            let newPoints = [];
            
            switch(type) {
                case 'straight-up':
                    for (let i = 0; i < 10; i++) {
                        newPoints.push({
                            x: 50 + i * (width - 100) / 9,
                            y: height - 50 - i * (height - 100) / 9
                        });
                    }
                    break;
                    
                case 'straight-down':
                    for (let i = 0; i < 10; i++) {
                        newPoints.push({
                            x: 50 + i * (width - 100) / 9,
                            y: 50 + i * (height - 100) / 9
                        });
                    }
                    break;
                    
                case 'scattered':
                    for (let i = 0; i < 15; i++) {
                        newPoints.push({
                            x: Math.random() * (width - 40) + 20,
                            y: Math.random() * (height - 40) + 20
                        });
                    }
                    break;
            }
            
            newPoints.forEach(point => {
                const pointElement = document.createElement('div');
                pointElement.className = 'point';
                pointElement.style.left = point.x + 'px';
                pointElement.style.top = point.y + 'px';
                
                pointElement.onclick = function(e) {
                    e.stopPropagation();
                    const index = points.findIndex(p => 
                        Math.abs(p.x - point.x) < 5 && Math.abs(p.y - point.y) < 5
                    );
                    if (index > -1) {
                        points.splice(index, 1);
                        pointElement.remove();
                        updateCorrelation();
                    }
                };
                
                plot.appendChild(pointElement);
                points.push(point);
            });
            
            updateCorrelation();
        }

        function explainResult(r, strength, direction) {
            const explanation = document.getElementById('resultExplanation');
            const r2 = r * r;
            
            explanation.innerHTML = `
                <h3>📊 Diễn giải kết quả: r = ${r > 0 ? '+' : ''}${r}</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div>
                        <h4>🎯 Ý nghĩa:</h4>
                        <p>Tương quan <strong>${direction} ${strength}</strong> giữa thời gian học và điểm thi.</p>
                    </div>
                    <div>
                        <h4>📈 Hướng:</h4>
                        <p>${direction === 'thuận' ? 'Học nhiều hơn → Điểm cao hơn' : 'Một biến tăng → Biến kia giảm'}</p>
                    </div>
                    <div>
                        <h4>💪 Mức độ:</h4>
                        <p>Mối liên hệ <strong>${strength}</strong> (${(Math.abs(r) * 100).toFixed(0)}% cường độ tối đa)</p>
                    </div>
                    <div>
                        <h4>🔢 R² = ${r2.toFixed(3)}:</h4>
                        <p>${(r2 * 100).toFixed(1)}% phương sai chung giữa hai biến</p>
                    </div>
                </div>
                <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>💡 Nói đơn giản:</strong> ${getSimpleExplanation(r, strength, direction)}
                </div>
            `;
            
            explanation.style.display = 'block';
        }

        function getSimpleExplanation(r, strength, direction) {
            if (Math.abs(r) >= 0.8) {
                return direction === 'thuận' ? 
                    'Học nhiều gần như chắc chắn sẽ được điểm cao!' :
                    'Có mối liên hệ nghịch rất rõ ràng!';
            } else if (Math.abs(r) >= 0.6) {
                return direction === 'thuận' ? 
                    'Học nhiều thường sẽ được điểm cao hơn.' :
                    'Có xu hướng nghịch khá rõ ràng.';
            } else if (Math.abs(r) >= 0.4) {
                return 'Có liên hệ nhưng không quá chặt chẽ, còn nhiều yếu tố khác ảnh hưởng.';
            } else {
                return 'Liên hệ rất yếu, có thể do ngẫu nhiên hoặc có nhiều yếu tố khác quan trọng hơn.';
            }
        }

        // Quiz Data
        const quizData = [
            {
                scenario: "Bạn là sinh viên tâm lý học, muốn tìm hiểu mối quan hệ giữa thời gian dùng điện thoại và điểm học tập.",
                question: "Bạn thu thập dữ liệu từ 100 sinh viên về giờ dùng điện thoại/ngày và GPA. Kết quả: r = -0.68, p = 0.001. Điều này có nghĩa là gì?",
                options: [
                    {
                        text: "Dùng điện thoại làm điểm học tập kém đi",
                        hint: "Có phải tương quan = nhân quả?"
                    },
                    {
                        text: "Có mối tương quan nghịch mạnh và có ý nghĩa thống kê",
                        hint: "Đúng cách diễn giải kết quả tương quan"
                    },
                    {
                        text: "68% sinh viên dùng điện thoại nhiều có điểm thấp",
                        hint: "Không phải cách hiểu r = 0.68"
                    },
                    {
                        text: "Kết quả không đáng tin cậy vì p > 0.05",
                        hint: "Kiểm tra lại giá trị p"
                    }
                ],
                correct: 1,
                explanation: "r = -0.68 cho thấy tương quan nghịch mạnh (|r| > 0.6) và p = 0.001 < 0.05 nên có ý nghĩa thống kê. Tuy nhiên, điều này KHÔNG có nghĩa là dùng điện thoại GÂY RA điểm kém - đó chỉ là mối liên hệ, không phải nhân quả."
            },
            {
                scenario: "Trong một nghiên cứu y học về sức khỏe tim mạch",
                question: "Bác sĩ nghiên cứu mối quan hệ giữa tuổi và huyết áp. Kết quả r = +0.45. Điều nào sau đây ĐÚNG nhất về kết quả này?",
                options: [
                    {
                        text: "Tương quan thuận trung bình - tuổi càng cao thì huyết áp có xu hướng cao hơn",
                        hint: "Diễn giải chính xác"
                    },
                    {
                        text: "Tuổi tác gây ra huyết áp cao",
                        hint: "Tương quan có nghĩa là nhân quả không?"
                    },
                    {
                        text: "45% bệnh nhân cao tuổi có huyết áp cao",
                        hint: "Không phải cách hiểu r = 0.45"
                    },
                    {
                        text: "Mối liên hệ quá yếu để có ý nghĩa",
                        hint: "r = 0.45 có được coi là yếu không?"
                    }
                ],
                correct: 0,
                explanation: "r = +0.45 cho thấy tương quan thuận ở mức trung bình (0.4 < |r| ≤ 0.6). Điều này có nghĩa là có xu hướng: tuổi càng cao thì huyết áp càng có khả năng cao hơn, nhưng không chặt chẽ lắm và không chứng minh nhân quả."
            },
            {
                scenario: "Thầy giáo muốn biết có nên tăng thời gian ôn tập cho lớp không",
                question: "Thầy thu thập dữ liệu từ 30 học sinh về giờ ôn tập và điểm kiểm tra. Với df = 28, r_critical = 0.361 (α = 0.05). Nếu tính được r = 0.42, kết luận gì?",
                options: [
                    {
                        text: "Chấp nhận H₀, không có tương quan có ý nghĩa",
                        hint: "So sánh |r| với r_critical"
                    },
                    {
                        text: "Từ chối H₀, có tương quan có ý nghĩa thống kê",
                        hint: "0.42 > 0.361 không?"
                    },
                    {
                        text: "Cần thu thập thêm dữ liệu vì mẫu quá nhỏ",
                        hint: "n = 30 có được coi là nhỏ không?"
                    },
                    {
                        text: "Kết quả không hợp lệ vì r > r_critical",
                        hint: "r > r_critical có nghĩa là gì?"
                    }
                ],
                correct: 1,
                explanation: "Vì |r| = 0.42 > r_critical = 0.361, ta từ chối H₀ và kết luận có tương quan có ý nghĩa thống kê giữa thời gian ôn tập và điểm số. Thầy có thể khuyến khích học sinh ôn tập nhiều hơn."
            },
            {
                scenario: "Trong một nghiên cứu về thể thao",
                question: "Nhà nghiên cứu tìm hiểu mối quan hệ giữa chiều cao và khả năng chơi bóng rổ (điểm số kỹ năng). Kết quả r = 0.78. R² = ?",
                options: [
                    {
                        text: "R² = 0.61 (61% phương sai chung)",
                        hint: "R² = r²"
                    },
                    {
                        text: "R² = 0.78 (78% phương sai chung)",
                        hint: "R² có bằng r không?"
                    },
                    {
                        text: "R² = 1.56 (156% phương sai chung)",
                        hint: "R² có thể > 1 không?"
                    },
                    {
                        text: "Không tính được R² từ thông tin này",
                        hint: "Cần gì để tính R²?"
                    }
                ],
                correct: 0,
                explanation: "R² = r² = (0.78)² = 0.61. Điều này có nghĩa là 61% phương sai trong kỹ năng bóng rổ được giải thích bởi chiều cao. Còn 39% phụ thuộc vào các yếu tố khác như kỹ thuật, kinh nghiệm, tốc độ..."
            },
            {
                scenario: "Nghiên cứu về hiệu quả học tập online",
                question: "Trong đại dịch, giáo viên thu thập dữ liệu về thời gian xem video bài giảng và điểm bài tập. Với n = 25 học sinh, muốn kiểm định H₁: 'Xem video nhiều hơn có liên quan đến điểm cao hơn'. Đây là kiểm định:",
                options: [
                    {
                        text: "Một đuôi, df = 25",
                        hint: "df = n hay n-2?"
                    },
                    {
                        text: "Một đuôi, df = 23",
                        hint: "H₁ có xác định hướng không?"
                    },
                    {
                        text: "Hai đuôi, df = 23",
                        hint: "H₁ có xác định hướng không?"
                    },
                    {
                        text: "Hai đuôi, df = 25",
                        hint: "Kiểm tra cả df và loại kiểm định"
                    }
                ],
                correct: 1,
                explanation: "H₁ xác định rõ hướng ('nhiều hơn → cao hơn') nên là kiểm định một đuôi. df = n - 2 = 25 - 2 = 23. Nếu H₁ chỉ nói 'có liên quan' thì mới là hai đuôi."
            },
            {
                scenario: "Nghiên cứu về stress và học tập",
                question: "Tâm lý học sinh thu thập dữ liệu về mức độ stress và khả năng tập trung của 50 sinh viên. Kết quả r = -0.32, p = 0.03. Theo chuẩn APA, kết quả được báo cáo như thế nào?",
                options: [
                    {
                        text: "r = -0.32, p = 0.03",
                        hint: "Còn thiếu thông tin gì?"
                    },
                    {
                        text: "r(48) = -0.32, p = 0.03",
                        hint: "Định dạng APA đầy đủ"
                    },
                    {
                        text: "r(50) = -0.32, p < 0.05",
                        hint: "df có đúng không?"
                    },
                    {
                        text: "Pearson correlation = -0.32, significant",
                        hint: "Có đúng định dạng APA không?"
                    }
                ],
                correct: 1,
                explanation: "Theo chuẩn APA: r(df) = giá trị, p = mức ý nghĩa. Với n = 50, df = 50 - 2 = 48. Viết đầy đủ là r(48) = -0.32, p = 0.03. Có thể thêm diễn giải: tương quan nghịch yếu có ý nghĩa thống kê."
            },
            {
                scenario: "Kinh doanh và phân tích thị trường",
                question: "Công ty phân tích mối quan hệ giữa chi phí quảng cáo và doanh thu. Biết chi phí QC và doanh thu đều là biến định lượng, phân phối chuẩn, và có mối quan hệ tuyến tính. Nên sử dụng loại tương quan nào?",
                options: [
                    {
                        text: "Pearson correlation",
                        hint: "Phù hợp với điều kiện nào?"
                    },
                    {
                        text: "Spearman correlation",
                        hint: "Khi nào dùng Spearman?"
                    },
                    {
                        text: "Kendall's tau",
                        hint: "Dùng trong trường hợp nào?"
                    },
                    {
                        text: "Phi coefficient",
                        hint: "Dùng cho loại dữ liệu nào?"
                    }
                ],
                correct: 0,
                explanation: "Pearson correlation phù hợp khi: (1) Dữ liệu định lượng ✓, (2) Phân phối chuẩn ✓, (3) Mối quan hệ tuyến tính ✓. Spearman dùng cho dữ liệu thứ tự hoặc không phân phối chuẩn. Kendall's tau cho mẫu nhỏ. Phi coefficient cho dữ liệu nhị phân."
            },
            {
                scenario: "Nghiên cứu tâm lý phát triển",
                question: "Nhà nghiên cứu muốn biết có mối liên hệ nào giữa tuổi và số từ vựng của trẻ em không. Thu thập dữ liệu từ 40 trẻ từ 2-6 tuổi. Kết quả r = 0.88, p < 0.001. Điều gì có thể KẾT LUẬN từ kết quả này?",
                options: [
                    {
                        text: "Tuổi tác quyết định 88% từ vựng của trẻ",
                        hint: "r = 0.88 có nghĩa là gì?"
                    },
                    {
                        text: "Có mối tương quan thuận rất mạnh và có ý nghĩa thống kê",
                        hint: "Cách diễn giải chính xác"
                    },
                    {
                        text: "Việc dạy từ vựng sẽ làm trẻ lớn nhanh hơn",
                        hint: "Hướng nhân quả có đúng không?"
                    },
                    {
                        text: "Kết quả sai vì r quá cao, không thực tế",
                        hint: "r = 0.88 có thể xảy ra không?"
                    }
                ],
                correct: 1,
                explanation: "Kết quả cho thấy tương quan thuận rất mạnh (r = 0.88 > 0.8) và có ý nghĩa thống kê (p < 0.001). Điều này hợp lý vì trẻ lớn thường biết nhiều từ hơn. Tuy nhiên, không thể kết luận nhân quả theo hướng nào."
            },
            {
                scenario: "Ứng dụng thực tế trong y tế",
                question: "Bác sĩ nghiên cứu 100 bệnh nhân về mối quan hệ giữa BMI và nguy cơ tiểu đường (điểm số từ 0-100). Kết quả r = 0.72, p < 0.001. Bác sĩ muốn dùng BMI để DỰ ĐOÁN nguy cơ tiểu đường cho bệnh nhân mới. Bước tiếp theo nên là gì?",
                options: [
                    {
                        text: "Dừng lại, đã có đủ thông tin để dự đoán",
                        hint: "Tương quan có đủ để dự đoán không?"
                    },
                    {
                        text: "Làm phân tích hồi quy tuyến tính để có công thức dự đoán",
                        hint: "Cần gì để dự đoán giá trị cụ thể?"
                    },
                    {
                        text: "Thu thập thêm dữ liệu vì mẫu chưa đủ lớn",
                        hint: "n = 100 có đủ lớn không?"
                    },
                    {
                        text: "Thử nghiệm can thiệp để kiểm tra nhân quả",
                        hint: "Có cần chứng minh nhân quả để dự đoán không?"
                    }
                ],
                correct: 1,
                explanation: "Tương quan chỉ cho biết mức độ liên hệ, không cung cấp công thức dự đoán cụ thể. Cần phân tích hồi quy để có phương trình: 'Nguy cơ = a + b × BMI', từ đó dự đoán được giá trị cụ thể cho bệnh nhân mới."
            },
            {
                scenario: "Nghiên cứu về công nghệ giáo dục",
                question: "Một trường đại học nghiên cứu xem có mối liên hệ giữa số lần đăng nhập hệ thống e-learning và điểm cuối kỳ không. Kết quả từ 150 sinh viên: r = 0.23, p = 0.004. Nhà nghiên cứu nên KẾT LUẬN gì?",
                options: [
                    {
                        text: "Không có mối liên hệ vì r nhỏ",
                        hint: "p-value nói gì về ý nghĩa thống kê?"
                    },
                    {
                        text: "Có tương quan thuận yếu nhưng có ý nghĩa thống kê",
                        hint: "Cần xem cả r và p-value"
                    },
                    {
                        text: "Đăng nhập nhiều chắc chắn sẽ điểm cao",
                        hint: "r = 0.23 có cho phép kết luận chắc chắn không?"
                    },
                    {
                        text: "Cần tăng cỡ mẫu để có kết quả đáng tin cậy",
                        hint: "n = 150 có đủ lớn không?"
                    }
                ],
                correct: 1,
                explanation: "r = 0.23 cho thấy tương quan thuận yếu (0.2 < |r| ≤ 0.4), nhưng p = 0.004 < 0.05 nên có ý nghĩa thống kê. Với n = 150, kết quả đáng tin cậy. Có mối liên hệ nhẹ giữa việc đăng nhập và điểm số, nhưng không mạnh."
            }
        ];

        let quizCurrentQuestion = 0;
        let quizUserAnswers = [];
        let quizCorrectAnswers = 0;

        function startQuiz() {
            // Hide current step
            if (currentStep < steps.length) {
                document.getElementById(steps[currentStep]).classList.remove('active');
            }
            
            document.getElementById('quiz').style.display = 'block';
            document.getElementById('quiz').classList.add('active');
            
            // Update progress to show quiz step
            document.getElementById('progressBar').style.width = '100%';
            
            // Update nav dots
            const dots = document.querySelectorAll('.nav-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index < 5) {
                    dot.classList.add('completed');
                } else {
                    dot.classList.add('active');
                }
            });
            
            quizCurrentQuestion = 0;
            quizUserAnswers = [];
            quizCorrectAnswers = 0;
            
            loadQuizQuestion();
        }

        function loadQuizQuestion() {
            const question = quizData[quizCurrentQuestion];
            
            document.getElementById('quizContent').innerHTML = `
                <div class="step-header">
                    <div class="step-number">${quizCurrentQuestion + 1}</div>
                    <div class="step-title">Câu ${quizCurrentQuestion + 1}/10</div>
                </div>

                <div class="quiz-progress">
                    <div class="quiz-progress-fill" style="width: ${((quizCurrentQuestion + 1) / quizData.length * 100)}%"></div>
                </div>

                <div class="real-example">
                    <h3>📋 Tình huống:</h3>
                    <p>${question.scenario}</p>
                </div>

                <div class="concept-box">
                    <h3>❓ Câu hỏi:</h3>
                    <p style="font-size: 1.2em;">${question.question}</p>
                </div>

                <div class="examples-grid" style="grid-template-columns: 1fr;">
                    ${question.options.map((option, index) => `
                        <div class="example-card quiz-option" onclick="selectQuizOption(${index})" data-index="${index}">
                            <div style="display: flex; align-items: flex-start;">
                                <span style="background: #3498db; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0;">
                                    ${String.fromCharCode(65 + index)}
                                </span>
                                <div style="flex: 1;">
                                    <div style="font-size: 1.1em; margin-bottom: 5px;">${option.text}</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d; font-style: italic;">${option.hint}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="interpretation" id="quizExplanation" style="display: none;">
                    <h4>💡 Giải thích:</h4>
                    <p id="explanationText">${question.explanation}</p>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="quizNextBtn" onclick="nextQuizQuestion()" style="display: none;">
                        ${quizCurrentQuestion === quizData.length - 1 ? '📊 Xem kết quả' : '➡️ Câu tiếp theo'}
                    </button>
                    <button class="btn btn-success" onclick="goToStep(4)">🔙 Quay lại bài học</button>
                </div>
            `;
        }

        function selectQuizOption(selectedIndex) {
            if (quizUserAnswers[quizCurrentQuestion] !== undefined) return; // Already answered
            
            const options = document.querySelectorAll('.quiz-option');
            const question = quizData[quizCurrentQuestion];
            
            // Store answer
            quizUserAnswers[quizCurrentQuestion] = selectedIndex;
            
            // Show results
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none';
                if (index === question.correct) {
                    option.style.background = '#27ae60';
                    option.style.color = 'white';
                    option.style.borderColor = '#229954';
                } else if (index === selectedIndex) {
                    option.style.background = '#e74c3c';
                    option.style.color = 'white';
                    option.style.borderColor = '#c0392b';
                }
            });
            
            // Count correct answers
            if (selectedIndex === question.correct) {
                quizCorrectAnswers++;
            }
            
            // Show explanation
            document.getElementById('quizExplanation').style.display = 'block';
            document.getElementById('quizNextBtn').style.display = 'inline-block';
        }

        function nextQuizQuestion() {
            if (quizCurrentQuestion < quizData.length - 1) {
                quizCurrentQuestion++;
                loadQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function showQuizResults() {
            const percentage = (quizCorrectAnswers / quizData.length * 100).toFixed(1);
            let grade, message, emoji, bgColor;
            
            if (percentage >= 80) {
                grade = 'Xuất sắc!';
                message = 'Bạn đã thực sự hiểu rõ về hệ số tương quan và biết cách ứng dụng vào thực tế!';
                emoji = '🌟';
                bgColor = '#27ae60';
            } else if (percentage >= 70) {
                grade = 'Tốt!';
                message = 'Bạn đã nắm được phần lớn kiến thức, chỉ cần ôn lại một số điểm nhỏ.';
                emoji = '👍';
                bgColor = '#2ecc71';
            } else if (percentage >= 60) {
                grade = 'Khá!';
                message = 'Bạn đã hiểu được cơ bản, hãy xem lại các câu sai để hiểu rõ hơn.';
                emoji = '😊';
                bgColor = '#f39c12';
            } else if (percentage >= 50) {
                grade = 'Trung bình!';
                message = 'Bạn cần ôn lại kiến thức về tương quan. Hãy xem lại bài học!';
                emoji = '📖';
                bgColor = '#e67e22';
            } else {
                grade = 'Cần cố gắng thêm!';
                message = 'Hãy xem lại toàn bộ bài học và thực hành thêm. Đừng nản chí!';
                emoji = '📚';
                bgColor = '#e74c3c';
            }
            
            // Create detailed review with colors
            const reviewItems = quizData.map((q, index) => {
                const isCorrect = quizUserAnswers[index] === q.correct;
                const icon = isCorrect ? '✅' : '❌';
                const bgClass = isCorrect ? '#d4edda' : '#f8d7da';
                const borderClass = isCorrect ? '#27ae60' : '#e74c3c';
                
                return `
                    <div style="display: flex; align-items: center; margin: 8px 0; padding: 12px; background: ${bgClass}; border-left: 4px solid ${borderClass}; border-radius: 5px;">
                        <span style="font-size: 18px; margin-right: 12px;">${icon}</span>
                        <span style="flex: 1;"><strong>Câu ${index + 1}:</strong> ${isCorrect ? 'Đúng' : 'Sai'}</span>
                        <span style="font-size: 14px; color: #7f8c8d;">
                            ${isCorrect ? q.options[q.correct].text.substring(0, 30) + '...' : 
                              'Đáp án: ' + q.options[q.correct].text.substring(0, 25) + '...'}
                        </span>
                    </div>
                `;
            }).join('');
            
            document.getElementById('quizContent').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">${emoji}</div>
                    <h2 style="color: ${bgColor}; margin-bottom: 20px; font-size: 2.5em;">${grade}</h2>
                    <div style="font-size: 3em; font-weight: bold; margin: 20px 0; color: ${bgColor};">
                        ${quizCorrectAnswers}/${quizData.length}
                    </div>
                    <div style="font-size: 2em; margin: 20px 0; color: ${bgColor}; font-weight: bold;">
                        ${percentage}%
                    </div>
                    <p style="font-size: 1.2em; margin: 20px 0; color: #34495e; max-width: 600px; margin-left: auto; margin-right: auto;">${message}</p>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 30px 0; text-align: left;">
                        <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.4em;">📊 Chi tiết kết quả:</h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                <div style="font-size: 2em; color: #27ae60; font-weight: bold;">${quizCorrectAnswers}</div>
                                <div style="color: #7f8c8d;">Câu đúng</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                <div style="font-size: 2em; color: #e74c3c; font-weight: bold;">${quizData.length - quizCorrectAnswers}</div>
                                <div style="color: #7f8c8d;">Câu sai</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                <div style="font-size: 2em; color: #3498db; font-weight: bold;">${percentage}%</div>
                                <div style="color: #7f8c8d;">Điểm đạt được</div>
                            </div>
                        </div>
                        
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${reviewItems}
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-primary" onclick="restartQuiz()">🔄 Làm lại quiz</button>
                        <button class="btn btn-success" onclick="goToStep(0)">🏠 Về đầu bài học</button>
                        <button class="btn btn-warning" onclick="goToStep(4)">📚 Xem lại tổng kết</button>
                    </div>
                </div>
            `;
        }

        function restartQuiz() {
            quizCurrentQuestion = 0;
            quizUserAnswers = [];
            quizCorrectAnswers = 0;
            loadQuizQuestion();
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initMiniScatters();
            initScatterPlot();
            updateNavDots();
            // Set initial progress
            document.getElementById('progressBar').style.width = (1 / totalSteps * 100) + '%';
        });
    </script>
</body>
</html>